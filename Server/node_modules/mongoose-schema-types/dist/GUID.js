"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mongoose = require("mongoose");
const validate = (value) => {
    const GUID_REGEX = /^(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}$/gi;
    if (typeof value !== "string") {
        throw mongoose.SchemaType.CastError("GUID", `Value is not string: ${value}`);
    }
    if (value.startsWith("{")) {
        value = value.substring(1, value.length - 1);
    }
    if (!GUID_REGEX.test(value)) {
        throw mongoose.SchemaType.CastError("GUID", `Value is not a valid GUID: ${value}`);
    }
    return value;
};
class GUID extends mongoose.SchemaType {
    constructor(key, options) {
        super(key, options, "GUID");
    }
    cast(val) {
        validate(val);
        return val;
    }
}
GUID.instance = "GUID";
mongoose.Schema.Types.GUID = GUID;
exports.default = GUID;
